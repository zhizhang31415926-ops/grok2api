<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, interactive-widget=overlays-content">
  <title>Grok2API - 图片编辑工作台</title>
  <link rel="icon" href="/static/common/img/favicon/favicon.ico">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#fafafa">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Grok2API">
  <link rel="apple-touch-icon" href="/static/public/pwa/apple-touch-icon.png">
  <script src="/static/vendor/tailwind/tailwindcss-cdn.js"></script>
  <link href="/static/vendor/geist/geist-sans.css" rel="stylesheet">
  <link href="/static/vendor/geist/geist-mono.css" rel="stylesheet">
  <script src="/static/common/js/theme.js?v=0.1.0"></script>
  <link href="/static/common/css/common.css?v=0.3.7" rel="stylesheet">
  <link href="/static/common/css/toast.css" rel="stylesheet">
  <link href="/static/public/css/imagine_workbench.css?v=0.1.9" rel="stylesheet">
</head>

<body class="public-page min-h-screen flex flex-col" style="background-color: var(--bg);">
  <div id="toast-container" class="toast-container"></div>
  <div id="app-header"></div>

  <main class="flex-1 container mx-auto max-w-6xl px-4 sm:px-6 py-5 sm:py-8 fade-in">
    <div class="space-y-4 sm:space-y-6">
      <div class="page-head">
        <div>
          <h2 class="text-2xl font-semibold tracking-tight">图片编辑工作台</h2>
          <p class="text-[var(--accents-4)] mt-1 text-sm">
            支持上传/粘贴/拖拽最多 3 张参考图进行编辑；编辑后沿用上一次输出的 parentPostId 继续链路。
          </p>
        </div>
        <div id="editStatusText" class="status-chip">未开始</div>
      </div>

      <div class="h-px bg-[var(--border)]"></div>

      <div class="workbench-grid">
        <section class="panel">
          <div class="panel-title">当前画面</div>

          <div class="upload-row">
            <input id="seedImageInput" class="hidden" type="file" accept="image/*" multiple>
            <button id="selectSeedBtn" type="button" class="geist-button-outline">添加参考图</button>
            <span id="seedFileName" class="file-name">已添加 0/3 张</span>
          </div>

          <div id="referenceStrip" class="reference-strip">
            <div class="reference-empty">可上传 / 粘贴 / 拖拽参考图（最多 3 张）</div>
          </div>

          <div class="parent-quick-row">
            <label class="field-label" for="parentPostInput">粘贴 parentPostId（全局记忆）</label>
            <div class="parent-quick-input-wrap">
              <input id="parentPostInput" class="geist-input" placeholder="粘贴 parentPostId 或包含它的 URL">
              <button id="applyParentBtn" type="button" class="geist-button-outline">使用</button>
            </div>
          </div>

          <div id="previewShell" class="preview-shell">
            <img id="currentImage" class="current-image hidden" alt="current-image">
            <div id="previewEmpty" class="preview-empty">请先添加参考图</div>
            <div id="dropHint" class="drop-hint">支持拖拽图片到此处，或按 Ctrl+V 粘贴图片</div>
          </div>

          <div class="meta-grid">
            <div class="meta-item">
              <div class="meta-label">当前 parentPostId</div>
              <div id="currentParentId" class="meta-value">-</div>
            </div>
            <div class="meta-item">
              <div class="meta-label">当前模式</div>
              <div id="currentMode" class="meta-value">upload</div>
            </div>
          </div>

          <div class="field">
            <label class="field-label" for="editPromptInput">编辑提示词</label>
            <textarea id="editPromptInput" class="geist-input form-textarea" placeholder="例如：保留人物姿态，把背景改为夜晚街景"></textarea>
          </div>

          <div class="action-row">
            <button id="submitEditBtn" type="button" class="geist-button">执行编辑</button>
            <button id="resetCycleBtn" type="button" class="geist-button-outline">重置链路</button>
            <button id="clearHistoryBtn" type="button" class="geist-button-outline">清空历史</button>
          </div>

          <div id="editProgressWrap" class="edit-progress-wrap">
            <div id="editProgressBar" class="edit-progress-bar"></div>
          </div>
          <div id="editProgressText" class="edit-progress-text">编辑中 0%</div>
        </section>

        <aside class="panel">
          <div class="panel-head">
            <div class="panel-title">编辑历史</div>
            <div id="historyCount" class="head-meta">0 条</div>
          </div>
          <div id="historyEmpty" class="empty-state">执行编辑后会在这里记录历史版本</div>
          <div id="historyList" class="history-list"></div>
        </aside>
      </div>
    </div>
  </main>

  <div class="mobile-fab" data-mobile-fab>
    <div class="mobile-fab-panel">
      <div class="mobile-fab-actions">
        <button class="geist-button-outline" data-proxy-click="#selectSeedBtn" type="button">添加参考图</button>
        <button class="geist-button-outline" data-proxy-click="#applyParentBtn" type="button">使用ID</button>
        <button class="geist-button" data-proxy-click="#submitEditBtn" type="button">执行编辑</button>
        <button class="geist-button-outline" data-proxy-click="#resetCycleBtn" type="button">重置链路</button>
        <button class="geist-button-outline" data-proxy-click="#clearHistoryBtn" type="button">清空历史</button>
      </div>
    </div>
    <button class="mobile-fab-toggle" data-fab-toggle type="button" aria-label="打开操作菜单">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14" />
      </svg>
    </button>
  </div>

  <div id="app-footer"></div>

  <script src="/static/common/js/admin-auth.js?v=0.3.0"></script>
  <script src="/static/common/js/parentpost-memory.js?v=0.1.0"></script>
  <script src="/static/common/js/public-header.js?v=0.3.3"></script>
  <script src="/static/common/js/footer.js?v=0.3.0"></script>
  <script src="/static/common/js/mobile-fab.js?v=0.1.1"></script>
  <script src="/static/common/js/toast.js"></script>
  <script src="/static/common/js/prompt-enhancer.js?v=0.1.15"></script>
  <script src="/static/common/js/pwa.js?v=0.1.1"></script>
  <script src="/static/public/js/imagine_workbench.js?v=0.1.4"></script>
</body>

</html>
